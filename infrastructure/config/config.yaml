# CLIProxyAPI Configuration Template
# WARNING: This is a template with placeholder values.
# Copy to config.yaml and replace CHANGE_ME values before deployment.

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================

# Server host/interface to bind to.
# Default is empty ("") to bind all interfaces (IPv4 + IPv6).
# In Docker, this should remain empty to allow container networking.
host: ""
# Server port - CLIProxyAPI main API endpoint
# This port is exposed to the frontend network for Caddy reverse proxy.
port: 8317
# TLS settings for HTTPS
# When enabled, the server listens with the provided certificate and key.
# NOTE: TLS is handled by Caddy in this deployment, so keep this disabled.
tls:
  enable: false
  cert: ""
  key: ""
# ============================================================================
# MANAGEMENT API CONFIGURATION
# ============================================================================
remote-management:
# Whether to allow remote (non-localhost) management access.
# Set to true since management API is accessed via internal Docker network
# from the dashboard service (not from external clients).
  allow-remote: true
# Management key - CRITICAL SECURITY SETTING
# This key is required for ALL management API requests.
# Leave empty when using MANAGEMENT_PASSWORD environment variable.
  secret-key: ""
# Disable the bundled management control panel asset download and HTTP route.
# Set to true since we're using our custom Next.js dashboard.
  disable-control-panel: true
# GitHub repository for the management control panel (not used with custom dashboard)
  panel-github-repository: "https://github.com/router-for-me/Cli-Proxy-API-Management-Center"
# ============================================================================
# AUTHENTICATION
# ============================================================================

# Authentication directory - stores OAuth tokens and authentication state
# Supports ~ for home directory. In Docker, this is mounted as a volume.
auth-dir: "/root/.cli-proxy-api"
# API keys for authentication
# These keys authenticate client requests to the API proxy endpoints.
# Replace with strong, randomly generated keys (e.g., use `openssl rand -hex 32`).
# WARNING: Keep these secret! Never commit real keys to version control.
api-keys:
  - ${API_KEY_PLACEHOLDER}
# ============================================================================
# LOGGING & DEBUGGING
# ============================================================================

# Enable debug logging (verbose output for troubleshooting)
# Set to true during initial setup, false for production.
debug: false
# Enable pprof HTTP debug server (host:port) for Go profiling.
# Keep it bound to localhost for safety. Only enable for performance debugging.
pprof:
  enable: false
  addr: "127.0.0.1:8316"
# Write application logs to rotating files instead of stdout
# Set to false - Docker best practice is to log to stdout for container orchestration.
logging-to-file: false
# Maximum total size (MB) of log files under the logs directory.
# When exceeded, oldest log files are deleted. Set to 0 to disable.
# If logging-to-file is false, this setting has no effect.
logs-max-total-size-mb: 0
# Maximum number of error log files retained when request logging is disabled.
# When exceeded, oldest error log files are deleted. Default is 10. Set to 0 to disable cleanup.
error-logs-max-files: 10
# ============================================================================
# PERFORMANCE & OPTIMIZATION
# ============================================================================

# Disable high-overhead HTTP middleware features to reduce per-request memory
# usage under high concurrency. Enable for production with high traffic.
commercial-mode: false
# Enable in-memory usage statistics aggregation
# Set to true for production monitoring, false to reduce memory overhead.
usage-statistics-enabled: true
# ============================================================================
# PROXY & NETWORKING
# ============================================================================

# Upstream proxy URL for outbound requests from CLIProxyAPI.
# Supports socks5/http/https protocols. Example: socks5://user:pass@192.168.1.1:1080/
# Leave empty if no upstream proxy is needed.
proxy-url: ""
# ============================================================================
# REQUEST HANDLING
# ============================================================================

# Unprefixed model requests only use credentials without a prefix
# (except when prefix == model name).
force-model-prefix: false
# Number of times to retry a request.
# Retries occur if HTTP response code is 403, 408, 500, 502, 503, or 504.
request-retry: 3
# Maximum wait time in seconds for a cooled-down credential before triggering a retry.
max-retry-interval: 30
# Quota exceeded behavior
quota-exceeded:
  switch-project: true # Auto-switch to another project when quota exceeded
  switch-preview-model: true # Auto-switch to preview model when quota exceeded
# Routing strategy for selecting credentials when multiple match.
# Options: "round-robin" (default), "fill-first"
routing:
  strategy: "round-robin"
# Enable authentication for the WebSocket API (/v1/ws).
# Set to true to require API key authentication for WebSocket connections.
ws-auth: true
# Emit blank lines every N seconds for non-streaming responses to prevent idle timeouts.
# Set to 0 to disable. Useful for long-running requests behind proxies with timeouts.
nonstream-keepalive-interval: 0
# Streaming behavior (SSE keep-alives + safe bootstrap retries)
streaming:
  keepalive-seconds: 15 # Send keep-alive every 15 seconds. <= 0 disables keep-alives.
  bootstrap-retries: 1 # Retries before first byte is sent. 0 disables retries.
# ============================================================================
# AI PROVIDER CONFIGURATIONS
# ============================================================================
# Below are example configurations for various AI providers.
# Uncomment and configure the providers you want to use.
# Replace placeholder API keys with your actual keys.
# ============================================================================

# ----------------------------------------------------------------------------
# GEMINI API KEYS (Google Generative AI)
# ----------------------------------------------------------------------------
# gemini-api-key:
#   - api-key: "AIzaSy...CHANGE_ME"
#     prefix: ""  # Optional: require calls like "prefix/gemini-2.5-flash" to target this credential
#     base-url: "https://generativelanguage.googleapis.com"
#     # headers:
#     #   X-Custom-Header: "custom-value"
#     # proxy-url: "socks5://proxy.example.com:1080"
#     # models:
#     #   - name: "gemini-2.5-flash"    # Upstream model name
#     #     alias: "gemini-flash"       # Client alias mapped to upstream model
#     # excluded-models:
#     #   - "gemini-2.5-pro"            # Exclude specific models (exact match)
#     #   - "gemini-2.5-*"              # Wildcard matching prefix

# ----------------------------------------------------------------------------
# CODEX API KEYS (OpenAI/Custom Codex Endpoints)
# ----------------------------------------------------------------------------
# codex-api-key:
#   - api-key: "sk-atSM...CHANGE_ME"
#     prefix: ""  # Optional: require calls like "prefix/gpt-5-codex" to target this credential
#     base-url: "https://api.openai.com/v1"
#     # headers:
#     #   X-Custom-Header: "custom-value"
#     # proxy-url: "socks5://proxy.example.com:1080"
#     # models:
#     #   - name: "gpt-5-codex"
#     #     alias: "codex-latest"
#     # excluded-models:
#     #   - "gpt-5.1"

# ----------------------------------------------------------------------------
# CLAUDE API KEYS (Anthropic Claude)
# ----------------------------------------------------------------------------
# claude-api-key:
#   - api-key: "sk-atSM...CHANGE_ME"  # Official Claude API key
#     # prefix: ""  # Optional: require calls like "prefix/claude-sonnet-latest" to target this credential
#     # base-url: ""  # Leave empty for official Claude API
#     # headers:
#     #   X-Custom-Header: "custom-value"
#     # proxy-url: "socks5://proxy.example.com:1080"
#     # models:
#     #   - name: "claude-3-5-sonnet-20241022"
#     #     alias: "claude-sonnet-latest"
#     # excluded-models:
#     #   - "claude-opus-4-5-20251101"
#     # cloak:  # Optional: request cloaking for non-Claude-Code clients
#     #   mode: "auto"        # "auto" (default), "always", or "never"
#     #   strict-mode: false  # false (default): prepend Claude Code prompt; true: strip user system messages
#     #   sensitive-words:
#     #     - "API"
#     #     - "proxy"

# ----------------------------------------------------------------------------
# OPENAI COMPATIBILITY PROVIDERS (e.g., OpenRouter, custom endpoints)
# ----------------------------------------------------------------------------
# openai-compatibility:
#   - name: "openrouter"  # Provider name (used in user agent)
#     prefix: ""          # Optional: require calls like "prefix/kimi-k2" to target this provider
#     base-url: "https://openrouter.ai/api/v1"
#     # headers:
#     #   X-Custom-Header: "custom-value"
#     api-key-entries:
#       - api-key: "sk-or-v1-...CHANGE_ME"
#         # proxy-url: "socks5://proxy.example.com:1080"
#     # models:
#     #   - name: "moonshotai/kimi-k2:free"
#     #     alias: "kimi-k2"

# ----------------------------------------------------------------------------
# VERTEX API KEYS (Vertex-compatible endpoints)
# ----------------------------------------------------------------------------
# vertex-api-key:
#   - api-key: "vk-123...CHANGE_ME"  # x-goog-api-key header
#     prefix: ""                     # Optional: require calls like "prefix/vertex-pro" to target this credential
#     base-url: "https://example.com/api"
#     # proxy-url: "socks5://proxy.example.com:1080"
#     # headers:
#     #   X-Custom-Header: "custom-value"
#     # models:
#     #   - name: "gemini-2.5-flash"
#     #     alias: "vertex-flash"

# ============================================================================
# OAUTH & MODEL ALIAS CONFIGURATION
# ============================================================================

# Global OAuth model name aliases (per channel)
# These aliases rename model IDs for both model listing and request routing.
# Supported channels: gemini-cli, vertex, aistudio, antigravity, claude, codex, qwen, iflow.
# NOTE: Aliases do not apply to explicit API key configurations above.
oauth-model-alias:
  antigravity:
    - name: "rev19-uic3-1p"
      alias: "gemini-2.5-computer-use-preview-10-2025"
    - name: "gemini-3-pro-image"
      alias: "gemini-3-pro-image-preview"
    - name: "gemini-3-pro-high"
      alias: "gemini-3-pro-preview"
    - name: "gemini-3-flash"
      alias: "gemini-3-flash-preview"
    - name: "claude-sonnet-4-5"
      alias: "gemini-claude-sonnet-4-5"
    - name: "claude-sonnet-4-5-thinking"
      alias: "gemini-claude-sonnet-4-5-thinking"
    - name: "claude-opus-4-5-thinking"
      alias: "gemini-claude-opus-4-5-thinking"

# OAuth provider excluded models
# Exclude specific models from OAuth providers using exact match or wildcards.
# oauth-excluded-models:
#   gemini-cli:
#     - "gemini-2.5-pro"     # Exact match
#     - "gemini-2.5-*"       # Wildcard prefix
#     - "*-preview"          # Wildcard suffix
#     - "*flash*"            # Wildcard substring

# ============================================================================
# ADVANCED: PAYLOAD CONFIGURATION
# ============================================================================
# Optional payload transformation rules for fine-grained request/response control.
# Use JSON path (gjson/sjson syntax) to set, override, or filter parameters.
# ============================================================================

# payload:
#   default:  # Default rules only set parameters when missing in payload
#     - models:
#         - name: "gemini-2.5-pro"  # Supports wildcards (e.g., "gemini-*")
#           protocol: "gemini"      # Restrict to protocol: openai, gemini, claude, codex, antigravity
#       params:  # JSON path -> value
#         "generationConfig.thinkingConfig.thinkingBudget": 32768
#
#   override:  # Override rules always set parameters, overwriting existing values
#     - models:
#         - name: "gpt-*"
#           protocol: "codex"
#       params:
#         "reasoning.effort": "high"
#
#   filter:  # Filter rules remove specified parameters from payload
#     - models:
#         - name: "gemini-2.5-pro"
#           protocol: "gemini"
#       params:  # JSON paths to remove from payload
#         - "generationConfig.thinkingConfig.thinkingBudget"

# ============================================================================
# CONFIGURATION CHECKLIST
# ============================================================================
# Before deploying, ensure you have:
# [ ] Run install.sh or manually created .env with secrets
# [ ] API keys and providers can be configured via the Dashboard UI
# [ ] Reviewed security settings (allow-remote, ws-auth)
# ============================================================================
